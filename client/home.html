<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Login">
	<meta name="author" content="">
	<link rel="icon" href="favicon.ico">
	<title>Home</title>

	<!-- Axios CDNs -->
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

	<!--BSStepper CDN -->
	<link rel="stylesheet" href="https://unpkg.com/bs-stepper/dist/css/bs-stepper.min.css">
	<script src="https://unpkg.com/bs-stepper/dist/js/bs-stepper.min.js"></script>


	<!-- Custom styles for this template -->
	<link rel="stylesheet" href="/css/home.css" type="text/css" />

	<base href="/">

	<!-- Bootstrap core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!-- Fontawesome CDN -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
		integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="/js/bootstrap.min.js"></script>

	<!-- Include bootstrap-multiselect CSS and JS: -->
	<script type="text/javascript" src="/js/bootstrap-multiselect.js"></script>
	<link rel="stylesheet" href="/css/bootstrap-multiselect.css" type="text/css" />

	<!-- Spinner css for buttons -->
	<link rel="stylesheet" href="/css/spinner.css" type="text/css" />

	<script type="text/javascript">
		$(document).ready(function () {
			// Make a request for the whmcs route using axios
			axios.get('/newusersvariables')
				.then(function (response) {
					// Get the client data from the response
					var data = response.data[0];

					// log all data thats returned
					console.log(data);

					// Load stepper after template
					myStepper = new Stepper(document.querySelector('#stepper-example'), {
						linear: false,
						animation: true
					});

					if (data) {
						// Remove special characters for the userid (to set the domain)

						var useridrmspchar = data.userid.toLowerCase().replace(/[\*\^\'\!\.]/g, '').split(' ').join('-');

						// Set text for the domain

						// Set text for the domain
						$("#txtDomain").text(useridrmspchar + '.' + data.domainname);


						// Show the modal
						$('#newuser').modal('show');

						var modulenames = [data.module1, data.module2, data.module3, data.module4, data.module5, data.module6];

						$.each(modulenames, function (i, modulenames) {
							$('#example-dropright').append($('<option>').text(modulenames).attr('value', modulenames));


						});
					}

					$('#example-dropright').multiselect({
						checkboxName: function (option) {
							return 'multiselect[]';
						},
						buttonWidth: '400px',
						dropRight: true
					});

					// Spinner
					$(function () {
						$('a, button').click(function () {
							$(this).toggleClass('active');
						});
					});

				})


				.catch(function (error) {
					// handle error
					console.log(error);
				})









		});// end of doc ready


		/// STUDENT FUNCTION

		function student(data, res) {

			/// main student function for setting up whmcs account and service

			axios.get('/newusersvariables')
				.then(function (response) {
					// Get the client data from the response
					var data = response.data[0];

					// log all data thats returned
					console.log(data);

					// create variables for the service to send to the route
					var useridrmspchar = data.userid.toLowerCase().replace(/[\*\^\'\!\.]/g, '').split(' ').join('-');
					var fulldomain = useridrmspchar + '.' + data.domainname;
					var nameserver1 = 'ns1.' + data.domainname;
					var nameserver2 = 'ns2.' + data.domainname;

					// Send a POST request
					axios({
						method: 'post',
						url: '/newstudentroute',
						data: {
							ID: data.ID,
							userid: data.userid,
							domainname: data.domainname,
							fulldomain: fulldomain,
							nameserver1: nameserver1,
							nameserver2: nameserver2,
							email: data.email,
							firstname: data.firstname,
							lastname: data.lastname,
							Address1: data.Address1,
							Address2: data.Address2,
							City: data.City,
							State: data.State,
							Postcode: data.Postcode,
							Country: data.Country,
							Phone: data.Phone,

							// selected moduled will need to go in here
							// array?

							// -------------
							AccountType: 'student'
						}

					});

				});



		}; // End of student function

					// STAFF FUNCTION WILL GO HERE
					//
					//
					//
					// ----------------------------



	</script>



</head>

<body>
	<!-- Modal start -->
	<div class="modal fade" id="newuser" tabindex="-1" role="dialog" aria-labelledby="newuser" aria-hidden="true"
		data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="newuser">
						New user - Getting started
					</h5>

					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">
							&times;
						</span>
					</button>
				</div>

				<div class="modal-body">
					<div id="stepper-example" class="bs-stepper">
						<div class="bs-stepper-header">
							<div class="step" data-target="#test-l-1">
								<a href="#">
									<span class="bs-stepper-circle">
										1
									</span>

									<span class="bs-stepper-label">
										Step one
									</span>
								</a>
							</div>

							<div class="line"></div>

							<div class="step" data-target="#test-l-2">
								<a href="#">
									<span class="bs-stepper-circle">
										2
									</span>

									<span class="bs-stepper-label">
										Step two
									</span>
								</a>
							</div>

							<div class="line"></div>

							<div class="step" data-target="#test-l-3">
								<a href="#">
									<span class="bs-stepper-circle">
										3
									</span>

									<span class="bs-stepper-label">
										Step 3
									</span>
								</a>
							</div>
						</div>

						<div class="bs-stepper-content">
							<div id="test-l-1" class="content">
								<p class="text-center">
									<p></p>
									The first time you use the service we have a few things to setup for you...

									<p></p>
									Your website domain will be:
									<p></p>

									<p></p>

									<p class="text-center">
										<b>
											<i id="txtDomain"></i>
										</b>
									</p>

									<p></p>
								</p>
								<p class="text-right">
									<button class="btn btn-primary" onclick="myStepper.next()">
										Next
									</button>
								</p>
							</div>

							<div id="test-l-2" class="content">
								<p class="text-center">
									<b>Tell us about the modules you are taking.</b>
									<p>
										<p class="text-center">We will use this to setup folders for you to put your
											work!</p>
										<p></p>
										<p class="text-center">Staff will use this to know locate your work!</p>

										<!-- Build your select: -->
										<p class="text-center">
											<select id="example-dropright" name="multiselect[]" multiple="multiple">

											</select>
										</p>

									</p>
									<p></p>
									<p></p>
									<p></p>
								</p>
								<p class="text-right">
									<button class="btn btn-primary" onclick="myStepper.next()">
										Next
									</button>
								</p>
							</div>

							<div id="test-l-3" class="content">
								<p class="text-center">
									<b>Select your account type, typically a student account.</b>
								</p>
								<p class="text-center">

									<div class="card-deck">
										<div class="card">
											<img class="card-img-top" src="/images/student.jpg" alt="Student account"
												width="100%" height="50%">
											<div class="card-body">
												<h5 class="card-title border-bottom pb-3">Student account</a></h5>
												<p class="card-text">If you are a student, select this account. Your web
													hosting package will be available to you during your time at
													university.</p>
												<button type="button" class="btn btn-success float-right has-spinner"
													onclick="student()"><span class="spinner"><i
															class="fa fa-refresh fa-spin"></i></span>Click Here</button>
											</div>
										</div>
										<div class="card">
											<img class="card-img-top" src="/images/staff.jpg" alt="Staff account"
												width="100%" height="50%">
											<div class="card-body">
												<h5 class="card-title border-bottom pb-3">Staff account</h5>
												<p class="card-text">If you are a member of teaching staff, select this
													account. This account type requires email validation.</p>
												<button type="button" class="btn btn-secondary float-right  has-spinner"
													onclick="myStepper.previous()"><span class="spinner"><i
															class="fa fa-refresh fa-spin"></i></span>Click Here</button>
											</div>
										</div>
									</div>

								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>